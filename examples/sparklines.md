---
id: litvis
elm:
    dependencies:
        gicentre/elm-vega: latest
---

@import "../styles/css/litvis.less"

# Sparklines with Extended Syntax

These tests call elm functions using the extended ('three hats') syntax.

The block below uses the compact syntax and should list the code and render a full-sized chart with multiple lines.

```elm {l v}
import VegaLite exposing (..)


lineChart : Spec
lineChart =
    -- This code should be displayed with the rendering of a histogram below it.
    let
        data =
            dataFromUrl "https://gicentre.github.io/data/randomWalk.csv"

        enc =
            encoding
                << position X [ PName "x", PmType Quantitative ]
                << position Y [ PName "y", PmType Quantitative ]
                << color [ MName "group", MmType Nominal ]
    in
    toVegaLite [ data [], enc [], mark Line [] ]
```

There should be no code or image displayed immediately below this line, but a hidden code block provides a parameterisable version of the line chart above.

```elm {l=hidden}
sparkline : String -> Spec
sparkline groupName =
    let
        config =
            configure << configuration (View [ Stroke Nothing, ViewHeight 15, ViewWidth 80 ])

        data =
            dataFromUrl "https://gicentre.github.io/data/randomWalk.csv"

        trans =
            transform << filter (FExpr ("datum.group == " ++ groupName))

        enc =
            encoding
                << position X [ PName "x", PmType Quantitative, PAxis [] ]
                << position Y [ PName "y", PmType Quantitative, PAxis [], PScale [ SZero False ] ]
                << color [ MString "black" ]
    in
    toVegaLite [ config [], data [], trans [], enc [], mark Line [] ]
```

_this message is intentionally blank_

Below should be a sparkline on its own line between this part of the sentence...

^^^elm v=(sparkline "1")^^^

... and above this part of the sentence.

And here is a paragraph of text that contains within it a sparkline.
The sparkline for group one should appear here : ^^^elm v=(sparkline "1")^^^ with this text immediately following it within the same block of text.
In other words, no new lines.
This paragraph is deliberately wordy to ensure we have enough text displayed to show the effect of inline graphics on line spacing.

Here is a sequence of sparklines displayed inline and mixed with markdown formatting for bullets:

*   First line ^^^elm v=(sparkline "1")^^^ with sparkline to the left.
*   Second line ^^^elm v=(sparkline "2")^^^ with sparkline to the left.
*   Third line ^^^elm v=(sparkline "3")^^^ with sparkline to the left.
*   Fourth line ^^^elm v=(sparkline "4")^^^ with sparkline to the left.
*   Fifth line ^^^elm v=(sparkline "5")^^^ with sparkline to the left.

And the same set of sparklines in a table:

| Group | Product      |       Value over time       |           Reorder supply? |
| ----- | ------------ | :-------------------------: | ------------------------: |
| 1     | Apples       | ^^^elm v=(sparkline "1")^^^ |                       Yes |
| 2     | Beatles      | ^^^elm v=(sparkline "2")^^^ |                        No |
| 3     | Fork Handles | ^^^elm v=(sparkline "3")^^^ | No, but we need 4 candles |
| 4     | Penguins     | ^^^elm v=(sparkline "4")^^^ |                        No |
| 5     | Orange steam | ^^^elm v=(sparkline "5")^^^ |                        No |

## Nested delimeters

This should display the sparkline for group 2 (matching 'Beatles' above) based on a simple arithmetic expression in nested brackets: ^^^elm v=(sparkline (toString (1+1)))^^^

This should display the full line chart based on a list with a single item: ^^^elm v=[(lineChart)]^^^

This should display a single group 2 sparkline based on a list with a single item: ^^^elm v=[(sparkline "2")]^^^

And the same using an expression with nested brackets: ^^^elm v=[(sparkline (toString (1+1)))]^^^

Four sparklines based on groups 2, 3, 4 and 5 with nested brackets inside a list:

^^^elm v=[(sparkline (toString (1+1))),(sparkline (toString (1+2))),(sparkline (toString (1+3))),(sparkline (toString (1+4)))]^^^

<!-- Single sparkline group4 based on list fold (nested square brackets) ^^^elm v=\[(1,sparkline (toString (List.sum [1,1,1,1]))]^^^  -->

<!--
^^^elm v=\[(sparkline (toString(List.sum[1])))]^^^ -->

Test function that generates a group number string from a list:

```elm {l}
groupFromList : String
groupFromList =
    toString (List.sum [ 1, 2, 1 ])
```

Sparkline group 1 generated by calling `groupFromList` to provide the group name.
^^^elm v=[(sparkline groupFromList)]^^^

Sparkline group 1 generated by calling inline list function to provide the group name.
_Atom insists on escaping the first `[`, which results in error. Uncomment line below to reveal problem_

<!-- ^^^elm v=[(sparkline (toString (List.sum [ 1, 2, 1 ])))]^^^ -->
